---
import Base from '../layouts/Base.astro';
import { getLanguageFromURL, loadTranslations } from '../lib/i18n';

// Load translations for this page
const currentLang = getLanguageFromURL(Astro.url.pathname);
const translations = await loadTranslations(currentLang);
---

<Base
  title="Concept - Interactive Program Experience"
  description="Discover our programs through an interactive scroll experience showcasing Sing for Hope Pianos, Education, Public Health & Wellness, Arts Diplomacy, and Workforce Development."
>
  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.157.0/build/three.min.js"></script>

  <div class="concept-page">
    <!-- Fixed 3D Scene -->
    <div id="three-scene" class="fixed inset-0 z-0"></div>

    <!-- Navigation -->
    <div id="back-to-home" class="fixed top-4 left-4 z-50 opacity-0 transform -translate-y-4 transition-all duration-300 pointer-events-none">
      <a href="/" class="flex items-center px-4 py-2 bg-black/20 backdrop-blur-md rounded-full text-white hover:bg-black/30 transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to Home
      </a>
    </div>

    <!-- Scroll Progress Indicator -->
    <div class="fixed top-0 left-0 w-full h-1 bg-black/20 z-40">
      <div id="progress-bar" class="h-full bg-white transform origin-left scale-x-0"></div>
    </div>

    <!-- Content Sections -->
    <div class="relative z-10">
      <!-- Hero Section -->
      <section class="section h-screen flex items-center justify-center" data-program="hero">
        <div class="content-area text-center text-white max-w-4xl px-8 mx-4">
          <h1 class="text-5xl md:text-7xl font-bold mb-6 opacity-0" data-animate="fadeUp">
            Our Programs
          </h1>
          <p class="text-xl md:text-2xl opacity-90 mb-8 opacity-0" data-animate="fadeUp" data-delay="0.2">
            Transforming communities through the power of arts
          </p>
          <div class="text-sm opacity-70 opacity-0" data-animate="fadeUp" data-delay="0.4">
            Scroll to explore each program
          </div>
        </div>
      </section>

      <!-- Pianos Section -->
      <section class="section h-screen flex items-center justify-center" data-program="pianos" data-color="#339933">
        <div class="content-area max-w-4xl px-8 mx-4 grid md:grid-cols-2 gap-12 items-center">
          <div class="text-white">
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 opacity-0" data-animate="fadeUp">
              <svg class="w-5 h-5 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7" />
              </svg>
              <span class="font-medium">Public Art Initiative</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold mb-6 opacity-0" data-animate="fadeUp" data-delay="0.1">
              Sing for Hope Pianos
            </h2>
            <p class="text-xl opacity-90 leading-relaxed mb-8 opacity-0" data-animate="fadeUp" data-delay="0.2">
              Artist-designed pianos bringing music, joy, and community connection to public spaces, healthcare facilities, and neighborhoods around the world.
            </p>
            <div class="space-y-4 opacity-0" data-animate="fadeUp" data-delay="0.3">
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>500+ Artist-designed pianos placed worldwide</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Free public access in communities</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Creating connections through music</p>
              </div>
            </div>
          </div>
          <div class="opacity-0" data-animate="fadeUp" data-delay="0.4">
            <div id="piano-3d-container" class="text-center p-8 bg-white/10 backdrop-blur-sm rounded-2xl h-64 flex items-center justify-center">
              <div class="text-white/60">
                <div class="text-4xl mb-2">üéπ</div>
                <p class="text-sm">3D Piano</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Education Section -->
      <section class="section h-screen flex items-center justify-center" data-program="education" data-color="#54749E">
        <div class="content-area max-w-4xl px-8 mx-4 grid md:grid-cols-2 gap-12 items-center">
          <div class="opacity-0" data-animate="fadeUp">
            <div id="school-3d-container" class="text-center p-8 bg-white/10 backdrop-blur-sm rounded-2xl h-64 flex items-center justify-center">
              <div class="text-white/60">
                <div class="text-4xl mb-2">üè´</div>
                <p class="text-sm">3D School</p>
              </div>
            </div>
          </div>
          <div class="text-white">
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 opacity-0" data-animate="fadeUp" data-delay="0.1">
              <svg class="w-5 h-5 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
              <span class="font-medium">Pre-K to High School</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold mb-6 opacity-0" data-animate="fadeUp" data-delay="0.2">
              Education Programs
            </h2>
            <p class="text-xl opacity-90 leading-relaxed mb-8 opacity-0" data-animate="fadeUp" data-delay="0.3">
              Comprehensive arts education programs serving students from pre-K through high school with innovative curriculum, performances, and community engagement.
            </p>
            <div class="space-y-4 opacity-0" data-animate="fadeUp" data-delay="0.4">
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>HandaHarmony global community programs</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>50,000+ Students reached through programs</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Careers in arts & artivism curriculum</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Health Section -->
      <section class="section h-screen flex items-center justify-center" data-program="health" data-color="#FDD05E">
        <div class="content-area max-w-4xl px-8 mx-4 grid md:grid-cols-2 gap-12 items-center">
          <div class="text-white">
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 opacity-0" data-animate="fadeUp">
              <svg class="w-5 h-5 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
              <span class="font-medium">Healing Through Arts</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold mb-6 opacity-0" data-animate="fadeUp" data-delay="0.1">
              Public Health & Wellness
            </h2>
            <p class="text-xl opacity-90 leading-relaxed mb-8 opacity-0" data-animate="fadeUp" data-delay="0.2">
              Research-based creative interventions, performances, and curated cultural experiences that promote wellness and connection in healthcare settings.
            </p>
            <div class="space-y-4 opacity-0" data-animate="fadeUp" data-delay="0.3">
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Research-based creative interventions</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>100+ Healthcare facilities served</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Promoting wellness & connection</p>
              </div>
            </div>
          </div>
          <div class="opacity-0" data-animate="fadeUp" data-delay="0.4">
            <div id="health-3d-container" class="text-center p-8 bg-white/10 backdrop-blur-sm rounded-2xl h-64 flex items-center justify-center">
              <div class="text-white/60">
                <div class="text-4xl mb-2">üè•</div>
                <p class="text-sm">3D Healthcare</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Diplomacy Section -->
      <section class="section h-screen flex items-center justify-center" data-program="diplomacy" data-color="#DA4680">
        <div class="content-area max-w-4xl px-8 mx-4 grid md:grid-cols-2 gap-12 items-center">
          <div class="opacity-0" data-animate="fadeUp">
            <div id="diplomacy-3d-container" class="text-center p-8 bg-white/10 backdrop-blur-sm rounded-2xl h-64 flex items-center justify-center">
              <div class="text-white/60">
                <div class="text-4xl mb-2">üåç</div>
                <p class="text-sm">3D Globe</p>
              </div>
            </div>
          </div>
          <div class="text-white">
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 opacity-0" data-animate="fadeUp" data-delay="0.1">
              <svg class="w-5 h-5 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="font-medium">Arts for Global Peace</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold mb-6 opacity-0" data-animate="fadeUp" data-delay="0.2">
              Cultural Diplomacy
            </h2>
            <p class="text-xl opacity-90 leading-relaxed mb-8 opacity-0" data-animate="fadeUp" data-delay="0.3">
              Creative advocacy, leadership, and program design that drive the integration of the arts in policy, peace-building, and global convenings on social change.
            </p>
            <div class="space-y-4 opacity-0" data-animate="fadeUp" data-delay="0.4">
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Creative advocacy & leadership</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>25+ Countries with international programs</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Global peace-building initiatives</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Workforce Section -->
      <section class="section h-screen flex items-center justify-center" data-program="workforce" data-color="#3A3F42">
        <div class="content-area max-w-4xl px-8 mx-4 grid md:grid-cols-2 gap-12 items-center">
          <div class="text-white">
            <div class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 opacity-0" data-animate="fadeUp">
              <svg class="w-5 h-5 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <span class="font-medium">Empowering Creative Communities</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold mb-6 opacity-0" data-animate="fadeUp" data-delay="0.1">
              Creative Workforce Development
            </h2>
            <p class="text-xl opacity-90 leading-relaxed mb-8 opacity-0" data-animate="fadeUp" data-delay="0.2">
              Reframing the value proposition of the arts with innovative public-private partnerships that extend our creative industry beyond traditional models.
            </p>
            <div class="space-y-4 opacity-0" data-animate="fadeUp" data-delay="0.3">
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Public-private partnerships</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Creative industry expansion</p>
              </div>
              <div class="flex items-start text-white/90">
                <svg class="w-5 h-5 mt-1 mr-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <p>Reframing arts value proposition</p>
              </div>
            </div>
          </div>
          <div class="opacity-0" data-animate="fadeUp" data-delay="0.4">
            <div id="workforce-3d-container" class="text-center p-8 bg-white/10 backdrop-blur-sm rounded-2xl h-64 flex items-center justify-center">
              <div class="text-white/60">
                <div class="text-4xl mb-2">üë•</div>
                <p class="text-sm">3D Workforce</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Final Section -->
      <section class="section h-screen flex items-center justify-center" data-program="final">
        <div class="content-area text-center text-white max-w-4xl px-8 mx-4">
          <h2 class="text-5xl md:text-7xl font-bold mb-6 opacity-0" data-animate="fadeUp">
            Join Our Mission
          </h2>
          <p class="text-xl md:text-2xl opacity-90 mb-12 opacity-0" data-animate="fadeUp" data-delay="0.2">
            Together, we can bring the transformative power of arts to every community
          </p>
          <div class="flex flex-col sm:flex-row gap-4 sm:gap-4 justify-center items-center opacity-0" data-animate="fadeUp" data-delay="0.4">
            <a href="/donate" class="inline-flex items-center px-8 py-4 bg-white text-black rounded-full font-semibold hover:bg-opacity-90 transition-all duration-300 w-full sm:w-auto justify-center">
              Support Our Work
            </a>
            <a href="/about" class="inline-flex items-center px-8 py-4 border border-white text-white rounded-full font-semibold hover:bg-white hover:text-black transition-all duration-300 w-full sm:w-auto justify-center">
              Learn More
            </a>
          </div>
        </div>
      </section>
    </div>
  </div>

  <style>
    .concept-page {
      font-family: 'Inter', system-ui, sans-serif;
      overflow-x: hidden;
    }

    .section {
      position: relative;
      z-index: 10;
    }

    #three-scene {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }

    .content-area {
      position: relative;
      z-index: 20;
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Hide scrollbar but keep functionality */
    body::-webkit-scrollbar {
      width: 0px;
      background: transparent;
    }

    /* Custom animations */
    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fadeUp {
      animation: fadeUp 0.8s ease-out forwards;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .content-area {
        text-align: center;
      }
      
      .section {
        padding: 2rem 0;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }
  </style>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      initScrollAnimations();
      init3DScene();
    });

    // Custom scroll animation system
    function initScrollAnimations() {
      // Progress bar animation
      const progressBar = document.getElementById('progress-bar');
      const backToHome = document.getElementById('back-to-home');
      
      function updateProgressBar() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercentage = (scrollTop / scrollHeight) || 0;
        
        progressBar.style.transform = `scaleX(${scrollPercentage})`;
        
        // Show/hide back to home button
        if (scrollTop > window.innerHeight * 0.3) {
          backToHome.style.opacity = '1';
          backToHome.style.transform = 'translateY(0)';
          backToHome.style.pointerEvents = 'auto';
        } else {
          backToHome.style.opacity = '0';
          backToHome.style.transform = 'translateY(-1rem)';
          backToHome.style.pointerEvents = 'none';
        }
      }

      window.addEventListener('scroll', updateProgressBar);

      // Background color transitions and fade animations
      const sections = document.querySelectorAll('.section[data-color]');
      const threeScene = document.getElementById('three-scene');
      const animatedElements = document.querySelectorAll('[data-animate="fadeUp"]');
      
      const gradients = {
        '#339933': 'linear-gradient(135deg, #339933 0%, #226622 50%, #1a5219 100%)',
        '#54749E': 'linear-gradient(135deg, #54749E 0%, #38516a 50%, #2a3c50 100%)',
        '#FDD05E': 'linear-gradient(135deg, #FDD05E 0%, #bf8800 50%, #8e5f00 100%)',
        '#DA4680': 'linear-gradient(135deg, #DA4680 0%, #932e54 50%, #6b2240 100%)',
        '#3A3F42': 'linear-gradient(135deg, #3A3F42 0%, #262829 50%, #1a1b1c 100%)'
      };

      function handleScroll() {
        const scrollY = window.scrollY;
        const windowHeight = window.innerHeight;
        
        // Background transitions
        sections.forEach((section) => {
          const rect = section.getBoundingClientRect();
          const sectionTop = scrollY + rect.top;
          const sectionBottom = sectionTop + rect.height;
          const sectionMiddle = sectionTop + (rect.height / 2);
          
          if (scrollY + windowHeight / 2 > sectionTop && scrollY + windowHeight / 2 < sectionBottom) {
            const color = section.dataset.color;
            if (color && gradients[color]) {
              threeScene.style.background = gradients[color];
            }
          }
        });

        // Fade in animations
        animatedElements.forEach((element) => {
          if (!element.classList.contains('animated')) {
            const rect = element.getBoundingClientRect();
            if (rect.top < windowHeight * 0.8) {
              const delay = parseFloat(element.dataset.delay || 0) * 1000;
              
              setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
                element.classList.add('animated');
              }, delay);
            }
          }
        });
      }

      // Initialize elements
      animatedElements.forEach((element) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(60px)';
        element.style.transition = 'opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
      });

      // Throttled scroll listener
      let scrollTimeout;
      window.addEventListener('scroll', () => {
        if (scrollTimeout) clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(handleScroll, 10);
      });

      // Initial call
      handleScroll();
    }

    function init3DScene() {
      if (typeof THREE === 'undefined') {
        console.error('Three.js not loaded');
        return;
      }

      // Create individual 3D scenes for each container
      const containers = [
        { id: 'piano-3d-container', color: 0x339933, geometry: 'box' },
        { id: 'school-3d-container', color: 0x54749E, geometry: 'cone' },
        { id: 'health-3d-container', color: 0xFDD05E, geometry: 'cylinder' },
        { id: 'diplomacy-3d-container', color: 0xDA4680, geometry: 'sphere' },
        { id: 'workforce-3d-container', color: 0x3A3F42, geometry: 'tetrahedron' }
      ];

      containers.forEach(containerInfo => {
        const container = document.getElementById(containerInfo.id);
        if (!container) return;

        // Create scene for this container
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, container.offsetWidth / container.offsetHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        
        renderer.setSize(container.offsetWidth, container.offsetHeight);
        renderer.setClearColor(0x000000, 0);
        
        // Clear container and add renderer
        container.innerHTML = '';
        container.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(2, 2, 2);
        scene.add(directionalLight);

        // Create geometry based on type
        let geometry;
        switch (containerInfo.geometry) {
          case 'box':
            geometry = new THREE.BoxGeometry(1.5, 0.8, 0.8);
            break;
          case 'cone':
            geometry = new THREE.ConeGeometry(0.8, 1.5, 4);
            break;
          case 'cylinder':
            geometry = new THREE.CylinderGeometry(0.3, 0.3, 1.5);
            break;
          case 'sphere':
            geometry = new THREE.SphereGeometry(0.8, 32, 32);
            break;
          case 'tetrahedron':
            geometry = new THREE.TetrahedronGeometry(0.9);
            break;
        }

        const material = new THREE.MeshPhongMaterial({ 
          color: containerInfo.color, 
          transparent: true, 
          opacity: 0.8 
        });
        const mesh = new THREE.Mesh(geometry, material);
        
        scene.add(mesh);
        camera.position.z = 3;

        // Animation function for this object
        function animate() {
          requestAnimationFrame(animate);
          
          mesh.rotation.y += 0.01;
          mesh.rotation.x += 0.005;
          
          renderer.render(scene, camera);
        }

        // Handle resize for this container
        function handleResize() {
          if (container.offsetWidth > 0 && container.offsetHeight > 0) {
            camera.aspect = container.offsetWidth / container.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.offsetWidth, container.offsetHeight);
          }
        }

        window.addEventListener('resize', handleResize);

        // Start animation
        animate();

        // Add hover effects
        container.addEventListener('mouseenter', () => {
          mesh.scale.set(1.1, 1.1, 1.1);
          material.opacity = 1.0;
        });

        container.addEventListener('mouseleave', () => {
          mesh.scale.set(1, 1, 1);
          material.opacity = 0.8;
        });
      });
    }
  </script>
</Base>